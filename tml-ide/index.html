<!doctype html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>tML IDE Playground</title>
    <meta name="description" content="独立 tModLoader C# IDE Playground，支持补全、悬停文档与双层诊断。">
    <link rel="icon" type="image/png" href="/site/assets/imgs/Green_tModLoader.png">
  <script type="module" crossorigin src="/tml-ide/assets/index-R857y8B1.js"></script>
  <link rel="stylesheet" crossorigin href="/tml-ide/assets/index-BqzJwP0z.css">
</head>
<body>
    <div id="app" class="app-shell">
        <header class="app-header">
            <div class="window-controls" aria-hidden="true">
                <span class="window-dot"></span>
                <span class="window-dot"></span>
                <span class="window-dot"></span>
            </div>
            <div class="app-title-wrap">
                <h1 class="app-title">tML IDE Playground</h1>
                <p class="app-subtitle">workspace: tml-ide · C# API 补全</p>
            </div>
            <div class="workspace-switch" role="tablist" aria-label="工作区切换">
                <button class="workspace-btn workspace-btn-active" id="workspace-btn-csharp" type="button" data-workspace="csharp" role="tab" aria-selected="true">C# IDE</button>
                <button class="workspace-btn" id="workspace-btn-markdown" type="button" data-workspace="markdown" role="tab" aria-selected="false">Markdown IDE</button>
                <button class="workspace-btn" id="workspace-btn-shader" type="button" data-workspace="shader" role="tab" aria-selected="false">Shader</button>
            </div>
            <div class="app-header-actions">
                <button id="btn-open-unified-submit" type="button">统一提交</button>
                <button id="btn-route-submit-panel" type="button">提交面板</button>
                <button id="btn-save-workspace" type="button">保存工作区</button>
                <button id="btn-export-workspace" type="button">导出 workspace.v1.json</button>
                <label class="file-btn" for="input-import-workspace">导入工作区</label>
                <input id="input-import-workspace" type="file" accept="application/json,.json" hidden>
            </div>
        </header>

        <main id="workspace-csharp-root" class="app-main">
            <aside class="activity-bar" aria-label="Activity Bar">
                <div class="activity-group">
                    <button class="activity-btn activity-btn-active" type="button" data-activity="explorer" aria-label="Explorer">EX</button>
                    <button class="activity-btn" type="button" data-activity="search" aria-label="Search">SR</button>
                    <button class="activity-btn" type="button" data-activity="scm" aria-label="Source Control">SC</button>
                    <button class="activity-btn" type="button" data-activity="run" aria-label="Run and Debug">RN</button>
                    <button class="activity-btn" type="button" data-activity="extensions" aria-label="Extensions">EX</button>
                </div>
                <div class="activity-group activity-group-bottom">
                    <button class="activity-btn" type="button" data-activity="account" aria-label="Account">AC</button>
                    <button class="activity-btn" type="button" data-activity="settings" aria-label="Manage">ST</button>
                </div>
            </aside>

            <aside class="side-bar panel panel-files" aria-label="Primary Side Bar">
                <div class="panel-head">
                    <h2>EXPLORER</h2>
                    <span id="workspace-version" class="pill">workspace.v1</span>
                </div>
                <div class="panel-actions">
                    <button id="btn-add-file" type="button">新增 .cs</button>
                    <button id="btn-rename-file" type="button">重命名</button>
                    <button id="btn-delete-file" type="button">删除</button>
                </div>
                <ul id="file-list" class="file-list" aria-label="工程文件列表"></ul>
                <p class="panel-tip">支持多文件 C# 虚拟工程。内容自动保存到浏览器 IndexedDB。</p>
            </aside>

            <section class="panel panel-editor">
                <div class="panel-head">
                    <h2 id="active-file-name">Program.cs</h2>
                    <div class="panel-head-right">
                        <span id="index-info" class="pill">api-index.v2</span>
                        <button id="btn-run-diagnostics" type="button">运行诊断</button>
                    </div>
                </div>
                <div id="editor" class="editor" aria-label="C# 编辑器"></div>
            </section>

            <aside id="bottom-panel" class="panel panel-tools" aria-label="Panel">
                <div class="bottom-panel-head">
                    <div class="panel-tab-strip" role="tablist" aria-label="Panel Tabs">
                        <button class="panel-tab panel-tab-active" type="button" data-panel-tab="problems">Problems</button>
                        <button class="panel-tab" type="button" data-panel-tab="assembly">Assembly</button>
                        <button class="panel-tab" type="button" data-panel-tab="indexer">Indexer</button>
                        <button class="panel-tab" type="button" data-panel-tab="output">Output</button>
                    </div>
                    <button id="btn-toggle-bottom-panel" class="panel-collapse-btn" type="button" aria-label="隐藏底部面板">
                        <span class="panel-collapse-icon" aria-hidden="true">▾</span>
                    </button>
                </div>
                <div class="bottom-panel-body">
                    <section class="panel-view panel-view-active" data-panel-view="problems">
                        <div class="tool-group">
                            <label class="checkbox-row">
                                <input id="toggle-roslyn" type="checkbox">
                                <span>开启增强诊断（diagnostics.roslyn）</span>
                            </label>
                            <p class="panel-tip">默认启用规则诊断（diagnostics.rule）。增强诊断按需懒加载 Worker。</p>
                        </div>
                        <div class="tool-group">
                            <h3>诊断问题</h3>
                            <p id="problems-summary" class="problems-summary">Errors: 0 · Warnings: 0</p>
                            <ul id="problems-list" class="problems-list" aria-live="polite"></ul>
                        </div>
                    </section>

                    <section class="panel-view" data-panel-view="assembly">
                        <div class="tool-group">
                            <h3>追加程序集（assembly.import）</h3>
                            <label for="input-extra-dll">选择 DLL</label>
                            <input id="input-extra-dll" type="file" accept=".dll,application/octet-stream">
                            <label for="input-extra-xml">选择 XML 文档</label>
                            <input id="input-extra-xml" type="file" accept=".xml,text/xml,application/xml">
                            <button id="btn-import-assembly" type="button">导入并合并</button>
                            <p class="panel-tip">导入会话级扩展符号，不修改基础 api-index.v2.json。</p>
                        </div>
                    </section>

                    <section class="panel-view" data-panel-view="indexer">
                        <div class="tool-group">
                            <h3>离线索引生成（编译 DLL）</h3>
                            <p class="panel-tip">使用本地 dotnet CLI 反射 DLL 并生成 `api-index.v2.json`，示例默认指向 `after/tModLoader.dll`。</p>
                            <label for="input-indexer-dll-path">基础 DLL 路径（必填）</label>
                            <input id="input-indexer-dll-path" type="text" value="/mnt/f/DPapyru.github.io/after/tModLoader.dll" spellcheck="false">
                            <label for="input-indexer-xml-path">基础 XML 路径（可选，留空将自动尝试同名 .xml）</label>
                            <input id="input-indexer-xml-path" type="text" value="" spellcheck="false">
                            <label for="input-indexer-terraria-dll-path">Terraria.dll 路径（可选）</label>
                            <input id="input-indexer-terraria-dll-path" type="text" value="" spellcheck="false">
                            <label for="input-indexer-terraria-xml-path">Terraria.xml 路径（可选）</label>
                            <input id="input-indexer-terraria-xml-path" type="text" value="" spellcheck="false">
                            <label for="input-indexer-out-path">输出 JSON（必填）</label>
                            <input id="input-indexer-out-path" type="text" value="tml-ide-app/public/data/api-index.v2.json" spellcheck="false">
                            <label for="index-command-preview">基础索引命令</label>
                            <pre id="index-command-preview" class="cmd-preview"></pre>
                            <button id="btn-copy-index-command" type="button">复制基础索引命令</button>
                            <label for="input-append-dll-path">追加 DLL 路径（必填）</label>
                            <input id="input-append-dll-path" type="text" value="/path/to/extra-mod.dll" spellcheck="false">
                            <label for="input-append-xml-path">追加 XML 路径（可选）</label>
                            <input id="input-append-xml-path" type="text" value="" spellcheck="false">
                            <label for="input-append-out-path">输出 session pack（必填）</label>
                            <input id="input-append-out-path" type="text" value="tml-ide-app/public/data/session-pack.v1.json" spellcheck="false">
                            <label for="append-command-preview">追加会话命令</label>
                            <pre id="append-command-preview" class="cmd-preview"></pre>
                            <button id="btn-copy-append-command" type="button">复制追加命令</button>
                        </div>

                        <div class="tool-group">
                            <h3>导入生成索引（api-index.v2）</h3>
                            <label for="input-import-index">选择索引 JSON</label>
                            <input id="input-import-index" type="file" accept="application/json,.json">
                            <button id="btn-import-index" type="button">导入并替换当前索引</button>
                            <p class="panel-tip">用于加载你离线编译出的 `api-index.v2.json`，导入后立即参与补全/悬停/诊断。</p>
                        </div>
                    </section>

                    <section class="panel-view" data-panel-view="output">
                        <div class="tool-group">
                            <h3>最近事件</h3>
                            <ul id="event-log" class="event-log" aria-live="polite"></ul>
                        </div>
                    </section>
                </div>
            </aside>
        </main>

        <main id="workspace-subapp-root" class="workspace-subapp" hidden>
            <section class="subapp-frame-wrap">
                <div class="subapp-toolbar">
                    <span class="subapp-title" id="subapp-title">Markdown IDE</span>
                    <div class="subapp-toolbar-actions">
                        <button id="btn-subapp-reload" type="button">刷新子应用</button>
                        <button id="btn-subapp-open-submit" type="button">打开提交面板</button>
                    </div>
                </div>
                <iframe id="subapp-iframe" class="subapp-iframe" title="Unified IDE Subapp" loading="lazy"></iframe>
            </section>
            <aside id="unified-submit-panel" class="unified-submit-panel">
                <header class="unified-submit-head">
                    <h2>统一提交</h2>
                    <button id="btn-unified-submit-close" type="button">关闭</button>
                </header>
                <section class="unified-submit-section">
                    <label for="unified-worker-url">Worker API 地址</label>
                    <input id="unified-worker-url" type="text" value="https://greenhome-pr.3577415213.workers.dev/api/create-pr" spellcheck="false">
                </section>
                <section class="unified-submit-section">
                    <div class="unified-auth-row">
                        <button id="btn-unified-auth-login" type="button">GitHub 登录</button>
                        <button id="btn-unified-auth-logout" type="button">退出</button>
                    </div>
                    <div id="unified-auth-status" class="unified-auth-status">未登录</div>
                </section>
                <section class="unified-submit-section">
                    <label for="unified-pr-title">PR 标题（可选）</label>
                    <input id="unified-pr-title" type="text" placeholder="例如：docs: 统一IDE提交">
                </section>
                <section class="unified-submit-section">
                    <label for="unified-existing-pr-number">继续已有 PR（可选）</label>
                    <input id="unified-existing-pr-number" type="number" min="1" step="1" placeholder="留空=新建 PR">
                </section>
                <section class="unified-submit-section">
                    <label for="unified-anchor-select">Markdown 锚点（无 Markdown 时必选）</label>
                    <select id="unified-anchor-select">
                        <option value="">自动选择（若可用）</option>
                    </select>
                </section>
                <section class="unified-submit-section">
                    <div id="unified-summary" class="unified-summary">待收集 staged 改动。</div>
                    <div class="unified-submit-actions">
                        <button id="btn-unified-collect" type="button">收集改动</button>
                        <button id="btn-unified-submit" type="button">提交全部（自动分批）</button>
                        <button id="btn-unified-resume" type="button">续传失败批次</button>
                    </div>
                </section>
                <section class="unified-submit-section">
                    <h3>可提交文件</h3>
                    <ul id="unified-sendable-list" class="unified-file-list"></ul>
                </section>
                <section class="unified-submit-section">
                    <h3>需手工 PR 文件</h3>
                    <ul id="unified-blocked-list" class="unified-file-list"></ul>
                </section>
                <section class="unified-submit-section">
                    <h3>批次进度</h3>
                    <pre id="unified-batch-progress" class="unified-batch-progress">尚未提交。</pre>
                </section>
                <section class="unified-submit-section">
                    <div id="unified-submit-status" class="unified-submit-status">就绪</div>
                </section>
            </aside>
        </main>

        <footer class="app-statusbar">
            <span class="status-item status-item-main" id="editor-status" role="status" aria-live="polite"></span>
            <span class="status-item">C#</span>
            <span class="status-item">UTF-8</span>
            <span class="status-item">LF</span>
            <span class="status-item">Spaces: 4</span>
        </footer>
    </div>

    <div id="command-palette" class="command-palette" hidden>
        <button id="command-palette-backdrop" class="command-palette-backdrop" type="button" aria-label="关闭命令面板"></button>
        <section class="command-palette-dialog" role="dialog" aria-modal="true" aria-label="Command Palette">
            <label for="command-palette-input" class="command-palette-title">Command Palette</label>
            <input id="command-palette-input" class="command-palette-input" type="text" spellcheck="false" autocomplete="off" placeholder="输入命令（Ctrl+Shift+P）">
            <ul id="command-palette-results" class="command-palette-results" role="listbox" aria-label="命令列表"></ul>
        </section>
    </div>
</body>
</html>
