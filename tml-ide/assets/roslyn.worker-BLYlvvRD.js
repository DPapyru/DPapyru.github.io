(function(){"use strict";const l=Object.freeze({INDEX_SET:"index.set",INDEX_SET_RESPONSE:"index.set.response",COMPLETION_REQUEST:"completion.request",COMPLETION_RESPONSE:"completion.response",HOVER_REQUEST:"hover.request",HOVER_RESPONSE:"hover.response",DIAGNOSTICS_RULE_REQUEST:"diagnostics.rule.request",DIAGNOSTICS_RULE_RESPONSE:"diagnostics.rule.response",DIAGNOSTICS_ROSLYN_REQUEST:"diagnostics.roslyn.request",DIAGNOSTICS_ROSLYN_RESPONSE:"diagnostics.roslyn.response",ASSEMBLY_IMPORT_REQUEST:"assembly.import.request",ASSEMBLY_IMPORT_RESPONSE:"assembly.import.response",ERROR:"error"}),g=Object.freeze({INFO:"info",WARNING:"warning",ERROR:"error"});function O(e){const s=String(e||"").trim(),n=s.lastIndexOf("."),t=n>0?s.slice(0,n):"",r=n>0?s.slice(n+1):s;return{fullName:s,namespace:t,name:r,summary:"",members:{methods:[],properties:[],fields:[]}}}function d(e){(!e.members||typeof e.members!="object")&&(e.members={methods:[],properties:[],fields:[]}),Array.isArray(e.members.methods)||(e.members.methods=[]),Array.isArray(e.members.properties)||(e.members.properties=[]),Array.isArray(e.members.fields)||(e.members.fields=[])}function _(e){const s=Array.isArray(e.params)?e.params.map(r=>({name:String(r&&r.name||""),type:String(r&&r.type||"object"),optional:!!(r&&r.optional),defaultValue:r&&Object.prototype.hasOwnProperty.call(r,"defaultValue")?r.defaultValue:null})):[];let n=Number.isFinite(Number(e.minArgs))?Number(e.minArgs):0,t=Number.isFinite(Number(e.maxArgs))?Number(e.maxArgs):s.length;return n<0&&(n=0),t<n&&(t=n),{kind:"method",name:String(e.name||""),signature:String(e.signature||""),returnType:String(e.returnType||"void"),isStatic:!!e.isStatic,params:s,minArgs:n,maxArgs:t,summary:String(e.summary||""),returnsDoc:String(e.returnsDoc||""),paramDocs:e.paramDocs&&typeof e.paramDocs=="object"?e.paramDocs:{}}}function R(e){return{kind:"property",name:String(e.name||""),signature:String(e.signature||""),type:String(e.type||"object"),isStatic:!!e.isStatic,summary:String(e.summary||"")}}function h(e){return{kind:"field",name:String(e.name||""),signature:String(e.signature||""),type:String(e.type||"object"),isStatic:!!e.isStatic,summary:String(e.summary||"")}}function T(){return{schemaVersion:2,generatedAt:new Date().toISOString(),sources:[],types:{},lookup:{byShortName:{},namespaces:[]}}}function I(e){const s={},n=new Set;return Object.keys(e.types).forEach(t=>{const r=e.types[t],a=String(r.name||"").trim();a&&(Array.isArray(s[a])||(s[a]=[]),s[a].push(t),r.namespace&&n.add(r.namespace))}),Object.keys(s).forEach(t=>{s[t].sort((r,a)=>r.localeCompare(a))}),e.lookup={byShortName:s,namespaces:Array.from(n).sort((t,r)=>t.localeCompare(r))},e.lookup}function E(e){const s=T();if(!e||typeof e!="object")return s;s.generatedAt=String(e.generatedAt||s.generatedAt),Array.isArray(e.sources)&&(s.sources=e.sources.map(t=>({assemblyName:String(t&&t.assemblyName||""),dllPath:String(t&&t.dllPath||""),xmlPath:String(t&&t.xmlPath||"")})));const n=e.types&&typeof e.types=="object"?e.types:{};return Object.keys(n).forEach(t=>{const r=n[t],a=O(t);a.namespace=String(r&&r.namespace||a.namespace),a.name=String(r&&r.name||a.name),a.summary=String(r&&r.summary||""),d(a);const m=r&&r.members&&typeof r.members=="object"?r.members:{},u=Array.isArray(m.methods)?m.methods:[],o=Array.isArray(m.properties)?m.properties:[],S=Array.isArray(m.fields)?m.fields:[];a.members.methods=u.map(_).filter(i=>!!i.name).sort((i,c)=>{const N=i.name.localeCompare(c.name);if(N!==0)return N;const b=i.minArgs-c.minArgs;return b!==0?b:i.signature.localeCompare(c.signature)}),a.members.properties=o.map(R).filter(i=>!!i.name).sort((i,c)=>i.name.localeCompare(c.name)),a.members.fields=S.map(h).filter(i=>!!i.name).sort((i,c)=>i.name.localeCompare(c.name)),s.types[t]=a}),I(s),s}let p=E(null);function P(e){const s=[0];for(let n=0;n<e.length;n++)e[n]===`
`&&s.push(n+1);return s}function A(e,s){let n=0,t=0,r=e.length-1;for(;t<=r;){const a=Math.floor((t+r)/2);e[a]<=s?(n=a,t=a+1):r=a-1}return{line:n+1,column:s-e[n]+1}}function y(e,s,n,t,r,a,m){const u=Math.max(0,n),o=Math.max(u+1,t),S=A(s,u),i=A(s,o);e.push({code:r,severity:a,message:m,startLineNumber:S.line,startColumn:S.column,endLineNumber:i.line,endColumn:i.column})}function D(e){const s=String(e||""),n=P(s),t=[],r=/\b(?:class|struct|interface|enum|record)\s+[A-Za-z_][A-Za-z0-9_]*/.test(s),a=/\bnamespace\s+[A-Za-z_][A-Za-z0-9_.]*/.test(s);r&&!a&&y(t,n,0,Math.min(s.length,1),"ROSLYN_NAMESPACE_RECOMMEND",g.INFO,"建议为当前文件声明 namespace，以提升工程可维护性。");const m=new Set(p.lookup&&Array.isArray(p.lookup.namespaces)?p.lookup.namespaces:[]),u=/\busing\s+([A-Za-z_][A-Za-z0-9_.]*)\s*;/g;let o;for(;(o=u.exec(s))!==null;){const i=o[1];if(!m.size)break;m.has(i)||y(t,n,o.index,o.index+o[0].length,"ROSLYN_UNKNOWN_USING",g.WARNING,`using 命名空间未在当前索引中命中：${i}`)}const S=/\bTODO\b/g;for(;(o=S.exec(s))!==null;)y(t,n,o.index,o.index+4,"ROSLYN_TODO_NOTE",g.INFO,"检测到 TODO 标记，建议在提交前处理或说明。");return t}function f(e,s,n){self.postMessage({id:e,type:s,payload:n})}self.onmessage=function(e){const s=e&&e.data?e.data:{},n=s.id,t=s.type,r=s.payload||{};try{if(t===l.INDEX_SET){p=E(r.index),f(n,l.INDEX_SET_RESPONSE,{ok:!0});return}if(t===l.DIAGNOSTICS_ROSLYN_REQUEST){const a=D(r.text||"");f(n,l.DIAGNOSTICS_ROSLYN_RESPONSE,{diagnostics:a});return}throw new Error(`Unsupported message type: ${String(t||"")}`)}catch(a){f(n,l.ERROR,{message:a&&a.message?a.message:String(a)})}}})();
