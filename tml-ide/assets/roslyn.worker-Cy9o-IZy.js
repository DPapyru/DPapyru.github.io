(function(){"use strict";const p=Object.freeze({INDEX_SET:"index.set",INDEX_SET_RESPONSE:"index.set.response",ANALYZE_V2_REQUEST:"analyze.v2.request",ANALYZE_V2_RESPONSE:"analyze.v2.response",DIAGNOSTICS_ROSLYN_REQUEST:"diagnostics.roslyn.request",DIAGNOSTICS_ROSLYN_RESPONSE:"diagnostics.roslyn.response",ASSEMBLY_IMPORT_REQUEST:"assembly.import.request",ASSEMBLY_IMPORT_RESPONSE:"assembly.import.response",ERROR:"error"}),y=Object.freeze({INFO:"info",WARNING:"warning",ERROR:"error"});function O(e){const r=String(e||"").trim(),n=r.lastIndexOf("."),t=n>0?r.slice(0,n):"",s=n>0?r.slice(n+1):r;return{fullName:r,namespace:t,name:s,summary:"",baseType:"",interfaces:[],members:{methods:[],properties:[],fields:[]}}}function d(e){(!e.members||typeof e.members!="object")&&(e.members={methods:[],properties:[],fields:[]}),Array.isArray(e.members.methods)||(e.members.methods=[]),Array.isArray(e.members.properties)||(e.members.properties=[]),Array.isArray(e.members.fields)||(e.members.fields=[])}function _(e){const r=Array.isArray(e.params)?e.params.map(s=>({name:String(s&&s.name||""),type:String(s&&s.type||"object"),optional:!!(s&&s.optional),defaultValue:s&&Object.prototype.hasOwnProperty.call(s,"defaultValue")?s.defaultValue:null})):[];let n=Number.isFinite(Number(e.minArgs))?Number(e.minArgs):0,t=Number.isFinite(Number(e.maxArgs))?Number(e.maxArgs):r.length;return n<0&&(n=0),t<n&&(t=n),{kind:"method",name:String(e.name||""),signature:String(e.signature||""),returnType:String(e.returnType||"void"),isStatic:!!e.isStatic,params:r,minArgs:n,maxArgs:t,summary:String(e.summary||""),returnsDoc:String(e.returnsDoc||""),paramDocs:e.paramDocs&&typeof e.paramDocs=="object"?e.paramDocs:{}}}function h(e){return{kind:"property",name:String(e.name||""),signature:String(e.signature||""),type:String(e.type||"object"),isStatic:!!e.isStatic,summary:String(e.summary||"")}}function T(e){return{kind:"field",name:String(e.name||""),signature:String(e.signature||""),type:String(e.type||"object"),isStatic:!!e.isStatic,summary:String(e.summary||"")}}function R(){return{schemaVersion:2,generatedAt:new Date().toISOString(),sources:[],types:{},lookup:{byShortName:{},namespaces:[]}}}function I(e){const r={},n=new Set;return Object.keys(e.types).forEach(t=>{const s=e.types[t],a=String(s.name||"").trim();a&&(Array.isArray(r[a])||(r[a]=[]),r[a].push(t),s.namespace&&n.add(s.namespace))}),Object.keys(r).forEach(t=>{r[t].sort((s,a)=>s.localeCompare(a))}),e.lookup={byShortName:r,namespaces:Array.from(n).sort((t,s)=>t.localeCompare(s))},e.lookup}function A(e){const r=R();if(!e||typeof e!="object")return r;r.generatedAt=String(e.generatedAt||r.generatedAt),Array.isArray(e.sources)&&(r.sources=e.sources.map(t=>({assemblyName:String(t&&t.assemblyName||""),dllPath:String(t&&t.dllPath||""),xmlPath:String(t&&t.xmlPath||"")})));const n=e.types&&typeof e.types=="object"?e.types:{};return Object.keys(n).forEach(t=>{const s=n[t],a=O(t);a.namespace=String(s&&s.namespace||a.namespace),a.name=String(s&&s.name||a.name),a.summary=String(s&&s.summary||""),a.baseType=String(s&&s.baseType||""),a.interfaces=Array.isArray(s&&s.interfaces)?s.interfaces.map(i=>String(i||"")).filter(Boolean):[],d(a);const m=s&&s.members&&typeof s.members=="object"?s.members:{},u=Array.isArray(m.methods)?m.methods:[],o=Array.isArray(m.properties)?m.properties:[],l=Array.isArray(m.fields)?m.fields:[];a.members.methods=u.map(_).filter(i=>!!i.name).sort((i,c)=>{const N=i.name.localeCompare(c.name);if(N!==0)return N;const E=i.minArgs-c.minArgs;return E!==0?E:i.signature.localeCompare(c.signature)}),a.members.properties=o.map(h).filter(i=>!!i.name).sort((i,c)=>i.name.localeCompare(c.name)),a.members.fields=l.map(T).filter(i=>!!i.name).sort((i,c)=>i.name.localeCompare(c.name)),r.types[t]=a}),I(r),r}let S=A(null);function x(e){const r=[0];for(let n=0;n<e.length;n++)e[n]===`
`&&r.push(n+1);return r}function b(e,r){let n=0,t=0,s=e.length-1;for(;t<=s;){const a=Math.floor((t+s)/2);e[a]<=r?(n=a,t=a+1):s=a-1}return{line:n+1,column:r-e[n]+1}}function g(e,r,n,t,s,a,m){const u=Math.max(0,n),o=Math.max(u+1,t),l=b(r,u),i=b(r,o);e.push({code:s,severity:a,message:m,startLineNumber:l.line,startColumn:l.column,endLineNumber:i.line,endColumn:i.column})}function D(e){const r=String(e||""),n=x(r),t=[],s=/\b(?:class|struct|interface|enum|record)\s+[A-Za-z_][A-Za-z0-9_]*/.test(r),a=/\bnamespace\s+[A-Za-z_][A-Za-z0-9_.]*/.test(r);s&&!a&&g(t,n,0,Math.min(r.length,1),"ROSLYN_NAMESPACE_RECOMMEND",y.INFO,"建议为当前文件声明 namespace，以提升工程可维护性。");const m=new Set(S.lookup&&Array.isArray(S.lookup.namespaces)?S.lookup.namespaces:[]),u=/\busing\s+([A-Za-z_][A-Za-z0-9_.]*)\s*;/g;let o;for(;(o=u.exec(r))!==null;){const i=o[1];if(!m.size)break;m.has(i)||g(t,n,o.index,o.index+o[0].length,"ROSLYN_UNKNOWN_USING",y.WARNING,`using 命名空间未在当前索引中命中：${i}`)}const l=/\bTODO\b/g;for(;(o=l.exec(r))!==null;)g(t,n,o.index,o.index+4,"ROSLYN_TODO_NOTE",y.INFO,"检测到 TODO 标记，建议在提交前处理或说明。");return t}function f(e,r,n){self.postMessage({id:e,type:r,payload:n})}self.onmessage=function(e){const r=e&&e.data?e.data:{},n=r.id,t=r.type,s=r.payload||{};try{if(t===p.INDEX_SET){S=A(s.index),f(n,p.INDEX_SET_RESPONSE,{ok:!0});return}if(t===p.DIAGNOSTICS_ROSLYN_REQUEST){const a=D(s.text||"");f(n,p.DIAGNOSTICS_ROSLYN_RESPONSE,{diagnostics:a});return}throw new Error(`Unsupported message type: ${String(t||"")}`)}catch(a){f(n,p.ERROR,{message:a&&a.message?a.message:String(a)})}}})();
