---
title: 使用网页特殊动画模块
author: DPapyru
category: 怎么贡献
topic: article-contribution
last_updated: 2026-01-27
description: 用 C# 编写可视化动画，并在 docs/viewer.html 中嵌入（WASM 运行时）
difficulty: beginner
time: 10分钟
---

本文介绍站点的 `animts` 网页动画模块：用 C# 编写可视化动画（弹幕、NPC 对话、Boss/NPC 的 AI 分析动画、数学可视化等），并在文章中以“特殊语法”嵌入到 `docs/viewer.html`。

## 你会得到什么

- **文章内嵌动画**：Markdown 中用一个 `animts` 代码块引用 `anims/*.cs`。
- **C# 运行时 API**：`AnimContext` + `IAnimScript` + `ICanvas2D`（逐步扩展中）。
- **开发渲染器**：打开 `docs/anim-renderer.html` 预览（注意：不支持浏览器内编译）。

## 目录

- 基本概念与目录结构
- 在 Markdown 中嵌入动画（`animts` 语法）
- 脚本结构：`IAnimScript`
- 开发预览：`docs/anim-renderer.html`
- 常见问题与排错

## 基本概念与目录结构

动画相关的核心目录：

- 源码：`docs/anims/**/*.cs`
- 构建产物：`assets/anims/**/*.dll`
- 运行时：`assets/anims/runtime/*`
- 清单：`assets/anims/manifest.json`

注意：

- 文章里写的是 **`.cs` 路径**（`anims/*.cs`），运行时会通过清单映射到 `.dll`。
- 禁止在文章里写 URL 或跳出目录的路径（运行时会拒绝）。

## 快速开始（最短路径）

1. 在 `docs/anims/` 下创建一个 `*.cs` 动画脚本（示例：`docs/anims/demo-basic.cs`）。
2. 运行构建：`npm run build`（会生成 `assets/anims/*.dll` 与运行时）。
3. 在 Markdown 里用 `animts` 代码块引入（第一行写 `anims/*.cs` 路径）。

## `animts` 语法

在文章中插入下面这段：

```animts
anims/demo-basic.cs
```

渲染后会出现一个动画面板，并自动播放。

## 脚本结构：`IAnimScript`

每个动画脚本需要：

- 一个 `AnimEntry` 属性（入口名）
- 一个实现 `IAnimScript` 的类

```csharp
using AnimRuntime;
using AnimRuntime.Math;

[AnimEntry("demo-basic")]
public sealed class DemoBasic : IAnimScript
{
    public void OnInit(AnimContext ctx)
    {
        // ctx.Width / ctx.Height / ctx.Time
    }

    public void OnUpdate(float dt)
    {
        // 每帧更新逻辑
    }

    public void OnRender(ICanvas2D g)
    {
        g.Clear(new Color(8, 12, 16));
    }

    public void OnDispose()
    {
        // 释放资源
    }
}
```

目前 `ICanvas2D` 仅提供 `Clear`，后续会补充基础绘制能力。

## 开发预览：`docs/anim-renderer.html`

- 运行 `npm run build` 后，双击打开 `docs/anim-renderer.html`。
- 用“选择仓库目录”选中项目根目录（或 `docs/` 目录），从下拉框选择 `anims/*.cs`，再点“播放所选/复制 animts 代码块”。

注意：该渲染器 **不支持** 浏览器内编译 C#，必须先构建。

## 常见问题与排错

### 1) 找不到 dotnet

请安装 .NET 8 SDK 并确保命令行能运行 `dotnet --version`。

### 2) 页面提示“动画未构建或清单缺失”

先运行 `npm run build`，确认 `assets/anims/manifest.json` 与 `assets/anims/*.dll` 已生成。

### 3) 动画没有渲染

请检查：

1. 文章中的 `animts` 路径是否以 `anims/` 开头，且以 `.cs` 结尾。
2. 是否运行过 `npm run build`（部署/提交前必须构建）。
