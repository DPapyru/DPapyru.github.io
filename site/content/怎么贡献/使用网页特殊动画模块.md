---
title: 使用网页特殊动画模块
author: DPapyru
date: 2026-02-07
last_updated: 2026-02-19
difficulty: intermediate
time: 25分钟
description: 在当前项目中用 C# 动画脚本生成浏览器可运行产物，并在教程文章中嵌入展示
topic: article-contribution
order: 5
prev_chapter: ContentProjects解决方案说明.md
---

# 使用网页特殊动画模块

本文介绍当前站点的动画工作流：

1. 在 `site/content/anims/` 编写 C# 脚本
2. 通过构建生成 `site/assets/anims/*.js`
3. 在教程文章中使用 `{{anim:...}}` 嵌入展示

## 先理解模块定位

动画模块的目标是“教学可视化”，常见用途：

1. 演示流程和状态变化
2. 做数学或坐标直觉图示
3. 展示 NPC 或 Boss 行为的抽象过程

它不用于替代游戏内真实渲染逻辑。

## 目录与产物

请先熟悉以下路径：

1. 源码目录：`site/content/anims/**/*.cs`
2. 运行时产物：`site/assets/anims/**/*.js`
3. 清单文件：`site/assets/anims/manifest.json`
4. 浏览器运行时：`site/assets/js/animcs-js-runtime.js`

写文章时始终引用 `.cs` 路径，运行时由清单映射到 `.js`。

## 最短可运行流程

### 第1步：创建脚本

在 `site/content/anims/` 下新增一个脚本，例如 `demo-basic.cs`。

### 第2步：执行构建

运行：`npm run build`

构建完成后，确认：

1. `site/assets/anims/manifest.json` 已更新
2. 目标动画对应的 `.js` 产物存在

### 第3步：在 Markdown 中嵌入

在文章中写：

```text
{{anim:anims/demo-basic.cs}}
```

然后用 viewer 页面验证动画是否显示。

## 直接复用仓库已有动画

如果你现在只想把“可用动画”先放进文章，不需要先写新脚本。当前仓库已经有这些模块：

1. `anims/demo-basic.cs`
2. `anims/demo-math-transform.cs`
3. `anims/demo-eoc-ai.cs`
4. `anims/demo-mode-state.cs`
5. `anims/vec3-axis-orbit.cs`
6. `anims/matrix-mat4-transform.cs`

你可以直接把它们嵌入到教程中。

### 示例A：数学变换动画

这个模块适合讲“坐标变换、旋转、缩放、切变”的直觉。

```text
{{anim:anims/demo-math-transform.cs}}
```

{{anim:anims/demo-math-transform.cs}}

建议配套说明读者观察点：

1. 蓝色向量是原向量
2. 橙色向量是变换后的结果
3. 网格和基向量会随时间变化

### 示例B：EoC 行为抽象动画

这个模块适合讲“状态机、冲刺阶段、目标追踪”。

```text
{{anim:anims/demo-eoc-ai.cs}}
```

{{anim:anims/demo-eoc-ai.cs}}

建议配套说明读者观察点：

1. 敌对目标点随时间变化
2. 主体状态在悬停、冲刺、转阶段之间切换
3. 小怪刷新的节奏与主状态有关

### 示例C：通用模式切换动画

这个模块适合讲“同一逻辑在不同状态下的表现差异”。

```text
{{anim:anims/demo-mode-state.cs}}
```

{{anim:anims/demo-mode-state.cs}}

建议配套说明读者观察点：

1. 选择不同模式后，向量旋转行为会变化
2. 不锁定模式时会自动按时间变化
3. 这套模式切换不依赖 Boss 语义，可用于任意教学动画

### 示例D：Vec3 交互 3D 坐标轴

这个模块适合讲“右手系三维坐标、视角旋转、深度投影”的直觉。

```text
{{anim:anims/vec3-axis-orbit.cs}}
```

{{anim:anims/vec3-axis-orbit.cs}}

建议配套说明读者观察点：

1. 坐标约定为右手系（X 右、Y 上、Z 朝向观察者反方向）
2. 按住并拖拽：绕 Y/X 轴旋转视角
3. 鼠标滚轮：控制缩放比例

### 示例E：Mat4 矩阵计算与组合变换

这个模块适合讲“矩阵乘法、平移/旋转/缩放组合、矩阵元素含义”。

```text
{{anim:anims/matrix-mat4-transform.cs}}
```

{{anim:anims/matrix-mat4-transform.cs}}

建议配套说明读者观察点：

1. `mode-select` 可以切换仅平移、仅旋转、仅缩放、复合变换
2. 同时显示单位立方体（参考）和变换后立方体（结果）
3. 左上角实时输出当前 `Mat4` 的 4x4 元素

## 可选 Profile 配置（推荐）

如果你需要在播放时开启模式控件或调整高度，可以在动画类上声明 `AnimProfile`：

```csharp
[AnimEntry("demo-mode-state")]
[AnimProfile(
    Controls = "mode-select",
    HeightScale = 1.25f,
    ModeOptions = "0:自动|1:静止|2:顺时针|3:逆时针"
)]
public sealed class DemoModeState : IAnimScript
{
    // ...
}
```

说明：

1. `Controls = "mode-select"`：开启状态选择控件
2. `HeightScale`：设置画布高度比例（默认高度 `240`）
3. `ModeOptions`：`值:标签|值:标签` 的 DSL，值会写入 `ctx.Input.Mode`

## 减少重复代码：AnimGeom

如果你经常画坐标轴、箭头和向量，可直接复用 `AnimGeom`：

```csharp
var center = new Vec2(width * 0.5f, height * 0.58f);
var scale = MathF.Min(width, height) * 0.32f;
AnimGeom.DrawAxes(g, center, scale);
var tip = AnimGeom.ToScreen(vector, center, scale);
AnimGeom.DrawArrow(g, center, tip, new Color(120, 200, 255, 230), 2f, 11f);
```

这样可以明显减少每个动画里重复的几何样板代码。

## 脚本结构参考

一个最小脚本通常包含：

1. 入口特性 `AnimEntry`
2. `OnInit`
3. `OnUpdate`
4. `OnRender`
5. `OnDispose`

示例：

```csharp
using AnimRuntime;

[AnimEntry("demo-basic")]
public sealed class DemoBasic : IAnimScript
{
    public void OnInit(AnimContext ctx)
    {
    }

    public void OnUpdate(float dt)
    {
    }

    public void OnRender(ICanvas2D g)
    {
        g.Clear(new Color(8, 12, 16));
    }

    public void OnDispose()
    {
    }
}
```

## 文章内使用建议

1. 一节只放一个动画重点
2. 动画前先写“读者要观察什么”
3. 动画后给“验证点”或“下一步操作”

避免把动画当成装饰内容，优先服务教学目标。

## 常见问题

### Q1：页面提示动画未构建

先运行 `npm run build`，再检查清单和产物是否存在。

### Q2：脚本路径正确但仍不显示

确认引用路径是 `anims/*.cs`，不要写成 `assets/anims/*.js`。

### Q3：本地没有 dotnet

动画编译阶段依赖 .NET SDK。先安装并确认 `dotnet --version` 可用。

## 发布前检查

1. 动画脚本命名清晰
2. 文章中的 `{{anim:...}}` 路径合法
3. 本地构建后能在 viewer 看到动画
4. 文章解释说明与动画表现一致

## 给 AI 的项目特殊 Markdown 语法提示

如果你用 AI 辅助写教程，请明确告诉它使用本站扩展语法，而不是只写普通 Markdown。

可直接给 AI 这段约束：

```text
请按本站 viewer 扩展语法输出：
1) 动画：{{anim:anims/xxx.cs}}
2) 文档引用：[显示标题](相对路径/文件.md)
3) C#引用：{{cs:相对路径/文件.cs}} 或带 #cs: 选择器
4) 分流语法：{if 条件}...{else if 条件}...{else}...{end}
要求：指令独占一行；动画路径必须以 anims/ 开头且扩展名为 .cs。
```

## 小结

你现在可以把动画作为教学工具稳定接入站点。

如果你只做纯文本教程，可以直接跳过动画模块，专注写作即可。
