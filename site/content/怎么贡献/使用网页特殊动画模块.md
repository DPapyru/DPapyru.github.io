---
title: 使用网页特殊动画模块
author: DPapyru
date: 2026-02-07
last_updated: 2026-02-21
difficulty: intermediate
time: 35分钟
description: 在站点中使用 animcs 模块，包含本地 Dotnet 实时预览桥接、模块索引与排错流程
topic: article-contribution
order: 5
prev_chapter: ContentProjects解决方案说明.md
---

# 使用网页特殊动画模块

本文是当前仓库的 animcs 使用手册，覆盖：

1. 模块写作路径
2. 写作 IDE 内实时预览（本地 Dotnet 桥接）
3. 6 个核心教学模块（向量 / 矩阵 / 工具库）
4. 常见错误与排查

## 基本路径约定

动画源码与运行产物：

1. 源码：`site/content/anims/*.cs`
2. 编译产物：`site/assets/anims/*.js`
3. 清单：`site/assets/anims/manifest.json`
4. 运行时：`site/assets/js/animcs-js-runtime.js`

文章中始终引用 `.cs` 路径，不直接写 `.js`。

## 文章嵌入语法

可用两种：

1. 指令写法

```text
{{anim:anims/vec2-basic-ops.cs}}
```

2. 代码块写法（推荐给写作 IDE）

````text
```animcs
anims/vec2-basic-ops.cs
```
````

硬性要求：第一行必须是 `anims/*.cs`。

## 写作 IDE 实时预览（本地桥接）

### 1. 启动本地 Dotnet 桥接

在仓库根目录运行：

```bash
dotnet run --project site/tooling/tools/animcs-preview-bridge
```

默认监听：`http://127.0.0.1:5078`。

桥接健康检查：

```bash
curl http://127.0.0.1:5078/health
```

### 2. 在写作 IDE 内开启实时编译

1. 打开 `/tml-ide/?workspace=markdown`
2. 在文章中放入 `animcs` 代码块路径（`anims/*.cs`）
3. 从资源菜单打开对应 C# 文件编辑
4. 在 C# 编辑弹窗中确认桥接地址并点击“连接”
5. 开始输入：系统会以 400ms 防抖自动编译并推送预览

当前策略：

1. 仅对 `anims/*.cs` 触发实时编译
2. 编译成功：优先加载临时模块（不等整站 build）
3. 编译失败：立即中断播放并显示诊断（不回退 manifest）

## 核心模块索引（首版 6 个）

推荐优先使用以下模块名（kebab-case）：

1. `anims/vec2-basic-ops.cs`
2. `anims/vec2-project-decompose.cs`
3. `anims/vec3-axis-orbit.cs`
4. `anims/mat4-trs-compose.cs`
5. `anims/mat4-view-projection.cs`
6. `anims/animgeom-toolkit-recipes.cs`

对应观察点：

1. `vec2-basic-ops`：向量加减与缩放
2. `vec2-project-decompose`：投影与分解
3. `vec3-axis-orbit`：三维坐标轴与归一化向量
4. `mat4-trs-compose`：平移/旋转/缩放复合
5. `mat4-view-projection`：视图与投影关系
6. `animgeom-toolkit-recipes`：`AnimGeom` 常见组合

## 兼容映射（旧名仍可用）

旧入口仍保留，文档建议迁移到新名：

1. `anims/vector-basic.cs` -> `anims/vec2-basic-ops.cs`
2. `anims/vector-add-resolution.cs` -> `anims/vec2-project-decompose.cs`
3. `anims/matrix-mat4-transform.cs` -> `anims/mat4-trs-compose.cs`
4. `anims/demo-math-transform.cs` -> `anims/mat4-view-projection.cs`
5. `anims/vector-move.cs` -> `anims/animgeom-toolkit-recipes.cs`

## 语法支持重点

当前转译器已支持：

1. `if / else`
2. `for / while / foreach`
3. `switch`
4. `Vec2 / Vec3 / Mat4` 运算符降级

不支持：

1. `async / await`
2. `try / catch`
3. 复杂泛型与反射

## 构建与验证

发布前至少执行：

```bash
npm run build:animcs
npm run build
```

如果只验证语法链路，可补跑：

```bash
ANIMCS_AST_INTEGRATION=1 node --test site/tooling/scripts/animcs-compiler-ast.test.js
```

## 常见错误排查

1. `sourcePath 必须是 anims/*.cs`

原因：路径不在 `anims/` 或不是 `.cs`。

2. 预览不更新但桥接在线

先确认你编辑的是 `anims/*.cs`，不是 `code/*.cs`。

3. 编译失败后一直报错

修复语法后继续输入一次，实时编译会自动恢复并重新播放。

4. 本地可编译但网页报错

检查 `AnimProfile`、`ModeOptions`、以及是否用了未支持语法（如 `try/catch`）。
