---
title: AI Agent 的使用——在拥有水平后使用Agent提高开发速度
description: 理解 AI Agent 的能力、适用场景、前提条件、最佳实践
author: DPapyru
category: 方向性指导
topic: ai-agents
last_updated: 2026-01-30
difficulty: advanced
time: 25分钟
prev_chapter: DPapyru-如何用好AI.md
---

## 本章目标

学完本章，你能：

- 理解什么是 AI Agent
- 判断自己是否具备使用 Agent 的条件
- 在合适的场景中使用 Agent 提高效率
- 避免过度依赖 Agent 的陷阱

AI Agent 是比普通对话 AI 更强大的工具，但它有更高的使用门槛。先掌握基础的 Mod 开发能力，再考虑使用 Agent。

## 最短用法（写给 Agent 的指令模板）

```
目标：
- 我想要什么结果：

约束：
- tModLoader 版本：
- 不要引入第三方库：
- 只允许修改哪些文件/目录：

验收标准：
- 编译通过
- 进游戏能验证的行为：

输出方式：
- 先给计划，再改代码
- 改动点逐条说明
```

## 什么是 AI Agent？

### 定义

AI Agent 是能够"自主执行多步骤任务"的 AI 系统：

- 能**拆解复杂任务**
- 能**调用工具**（搜索、代码执行、文件读写）
- 能**根据中间结果调整策略**
- 能**持续工作直到完成目标**

### Agent vs 普通对话 AI

#### 普通对话 AI（例如 ChatGPT、Claude）

- **模式**：一问一答
- **你需要**：引导每一步
- **例子**：你问"怎么添加 NPC？"，AI 给出答案

#### AI Agent（例如 Cursor Agent、GitHub Copilot Workspace）

- **模式**：你给目标，它自己规划和执行
- **你需要**：审核和验证
- **例子**：你说"给所有 NPC 添加掉落物"，Agent 遍历文件、修改代码、生成提交

#### 示例对比

**任务**：创建 10 把不同颜色的剑，伤害从 10 到 100

**普通 AI 的流程**：
```
你：怎么创建一个剑？
AI：给你一个示例...
你：好的，那怎么创建 10 个不同的剑？
AI：你可以复制 10 份类，改伤害...
你：有没有更快的方法？
AI：你可以用模板生成，但需要自己写...
```

**AI Agent 的流程**：
```
你：创建 10 把剑，伤害从 10 到 100，不同颜色。

Agent 内部流程：
1. 分析需求（10 个剑，伤害递增，颜色不同）
2. 生成代码（循环创建 Item 类）
3. 生成贴图（可能提示你提供贴图）
4. 合成配方（添加到 AddRecipes）
5. 验证语法（检查编译是否通过）
6. 生成提交（你可以直接用 Git diff 查看）

你需要做的：
1. 查看所有改动
2. 调整细节（颜色、手感）
3. 进游戏测试
```

## 使用 Agent 的前提条件

### 你已经掌握

#### tModLoader 基础 API

- 能**独立写**物品、NPC、合成表
- 知道 Mod 的**文件结构**
- 能**看懂**大部分错误信息

#### 调试能力

- 能**定位问题**（看日志、看报错）
- 能**分析原因**（是语法错误、还是逻辑错误）
- 能**尝试修复**（改代码、查文档）

#### 项目理解

- 知道自己的 Mod **代码结构**
- 知道**哪些文件之间有关联**
- 知道**改了什么会影响什么**

#### 验证能力

- 能**判断 AI 输出**是否正确
- 能**编译和测试** Agent 生成的代码
- 能**发现潜在问题**（性能、Bug、安全）

### 不建议使用 Agent 的情况

#### 还在学基础语法

**问题**：Agent 输出你看不懂，无法判断是否正确。

**建议**：先学完 `Modder入门` 下的教程，能独立写代码。

#### 对 Mod 开发流程不熟悉

**问题**：不知道该检查什么，Agent 的 Bug 你看不到。

**建议**：先完整做过一个 Mod（从创建到发布）。

#### 不理解自己的代码

**问题**：Agent 可能改错了，你不知道。

**建议**：每行代码都理解，不清楚的先查文档或问 AI（对话模式）。

## Agent 的适用场景

### 场景1：批量生成相似内容

#### 示例：创建 20 个不同颜色的剑

**目标**：
- 20 把剑
- 伤害从 10 到 50（递增）
- 每把剑不同颜色
- 都能用铁锭合成

**Agent 做什么**：
1. 分析需求（数量、属性范围、颜色）
2. 生成代码（循环创建 Item 类）
3. 生成贴图（可能提示你提供）
4. 验证语法（检查编译是否通过）
5. 生成提交（Git diff）

**你需要做的**：
- 查看所有改动
- 调整细节（颜色值、手感数值）
- 进游戏测试实际效果

#### 提示词示例

```
给 Items 文件夹下创建 20 个剑类，要求：
- 类名：ColorSword0 到 ColorSword19
- 伤害：从 10 开始，每次 +2
- 颜色：依次使用 Terraria 的 20 种稀有度颜色
- 合成配方：都需要 10 个铁锭 + 1 个对应颜色的染料

请自动生成所有文件，并用 Git 提交。
```

### 场景2：查找和修改跨文件模式

#### 示例：给所有 NPC 添加掉落物

**目标**：所有自定义 NPC 都掉落"我的 Mod 物品"。

**Agent 做什么**：
1. 遍历文件（找到所有 NPC 类）
2. 修改代码（在 `NPCLoot` 添加物品）
3. 检查是否已有 `NPCLoot`（没有则添加）
4. 生成提交

**你需要做的**：
- 查看 Git diff，确认改动是否符合预期
- 检查是否有 NPC 不应该掉落物品（例如召唤物）
- 进游戏测试

#### 提示词示例

```
给 NPCs 文件夹下所有自定义 NPC 添加掉落物：
- 掉落物：MyMod 中的物品 ID 为 1234 的物品
- 数量：1 到 3 个（随机）
- 掉落率：50%

请在每个 NPC 类中添加 NPCLoot 方法，如果没有该方法的话。

最后生成 Git 提交。
```

### 场景3：调试复杂问题

#### 示例：多人模式下物品不同步

**目标**：找出为什么物品在多人模式下行为不一致。

**Agent 做什么**：
1. 分析代码（找到所有网络相关代码）
2. 对比单机和多人逻辑
3. 查找可能的同步问题（例如 `NetMessage.Send` 缺失）
4. 生成修复建议

**你需要做的**：
- 验证 Agent 的分析是否正确
- 测试修复方案（单机、多人都测试）
- 确保不破坏其他功能

#### 提示词示例

```
我的 Mod 在多人模式下有同步问题：
- 单机：物品使用效果正常
- 多人：服务端能看到效果，客户端看不到

请帮我分析可能的原因：
1. 查找所有 Item.UseItem 的调用
2. 检查是否有 NetMessage.Send
3. 给出修复建议

不要直接修改代码，先给我分析报告。
```

### 场景4：重构和代码清理

#### 示例：把重复代码提取为工具方法

**目标**：多个 NPC 都有相似的 AI 逻辑，提取为共同方法。

**Agent 做什么**：
1. 查找所有 NPC 类
2. 识别重复的代码模式
3. 提取为公共方法（放在 `ModSystem` 或单独类）
4. 修改所有 NPC 调用新方法

**你需要做的**：
- 查看重构后的代码
- 确认提取的方法逻辑正确
- 测试所有受影响的 NPC

#### 提示词示例

```
分析 NPCs 文件夹下所有 NPC 类，找出重复的 AI 逻辑。

如果发现相似的代码片段：
1. 提取为公共方法（放在 ModHelpers.cs）
2. 修改所有 NPC 调用新方法
3. 确保逻辑不变

最后生成 Git 提交。
```

## 常用 Agent 工具与使用方式

### Cursor

#### 特点

- **AI-First 代码编辑器**：专为 AI 辅助开发设计
- **Agent Mode**：全自主的复杂任务处理
- **Semantic Search**：整个代码库的语义搜索
- **多模型支持**：OpenAI、Anthropic、Gemini、xAI

#### 使用流程

1. 打开 Cursor，加载你的 Mod 项目
2. 按 `Ctrl+I` 进入 Agent Mode
3. 输入你的目标（例如："给所有 NPC 添加掉落物"）
4. Agent 自动执行，你可以实时看到改动
5. 完成后，用 Git diff 查看

#### 适用场景

- 中大型项目（文件较多）
- 需要频繁修改多文件
- 习惯使用 AI 编辑器

### GitHub Copilot Workspace

#### 特点

- **GitHub 官方 AI 工具**：直接在 GitHub 上使用
- **PR 创建和审核**：Agent 可以创建 PR、自动审核
- **多模型选择**：GPT、Claude、Gemini、xAI
- **CI 集成**：与 GitHub Actions 配合

#### 使用流程

1. 在 GitHub 仓库中打开 "Copilot Workspace"
2. 选择 Issue 或输入新任务
3. Agent 分析代码库，生成改动
4. 创建 Pull Request
5. 你审核并合并

#### 适用场景

- 团队协作项目
- 需要自动化 PR 创建
- 习惯在 GitHub 上工作

### Claude Code / OpenAI Canvas

#### 特点

- **代码分析能力**：可以理解大型代码库
- **文件操作**：可以读取、修改、创建文件
- **终端集成**：可以直接运行命令（编译、测试）

#### 使用流程

1. 在 Claude 或 OpenAI 界面中
2. 上传或挂载你的代码库
3. 描述任务
4. Agent 逐步执行，你可以实时看到日志

#### 适用场景

- 需要深度代码分析
- 想看到 Agent 的思考过程
- 需要运行编译、测试命令

## 使用 Agent 的最佳实践

### 1. 给清晰、有限的目标

#### 错误的目标

```
帮我做一个很好的 Mod
```

问题：太模糊，Agent 不知道从哪下手。

#### 正确的目标

```
给 Items 文件夹下所有物品添加 tooltips 说明。
要求：
- tooltips 描述物品的用途
- 每个物品的 tooltips 不超过 20 个字
```

清晰、有限、可验证。

### 2. 保留人工审核

#### 必须审核的点

- **代码逻辑**：Agent 的修改是否符合需求
- **安全性**：有没有引入危险代码（例如 `eval`）
- **性能**：有没有引入性能问题（每帧创建对象）
- **Bug 风险**：有没有破坏现有功能

#### 审核方法

- 使用 Git diff 查看所有改动
- 逐文件检查修改
- 重点看"新增"和"删除"的代码

### 3. 使用版本控制

#### 推荐流程

1. **Agent 工作前提交代码**
   ```bash
   git commit -m "before agent: backup"
   ```

2. **Agent 完成后查看改动**
   ```bash
   git diff
   ```

3. **有问题就回滚**
   ```bash
   git reset --hard HEAD
   ```

4. **没问题就提交**
   ```bash
   git add .
   git commit -m "agent: add tooltips to all items"
   ```

### 4. 分阶段使用

#### 第一阶段：让 Agent 草拟方案

```
请帮我分析如何给所有 NPC 添加掉落物，先不要修改代码，给我建议和步骤。
```

**你审核方案**：
- 方案是否合理
- 有没有遗漏的边界情况
- 有没有更好的方式

#### 第二阶段：让 Agent 执行修改

```
方案看起来不错，请按照这个方案执行修改。
```

**你验证修改**：
- 查看代码改动
- 检查是否符合方案

#### 第三阶段：你自己调整细节

```
Agent 的代码可以，但我想调整掉落率和掉落数量，自己改。
```

**你主导**：
- 根据自己的需求调整细节
- 测试、优化、完善

### 5. 限制 Agent 的权限

#### 限制文件范围

```
只修改 Items 文件夹下的文件，不要动 NPCs 和 Projectiles。
```

#### 限制操作类型

```
只添加代码，不要删除或重构现有逻辑。
```

#### 限制使用的外部库

```
只用 tModLoader 官方 API，不要引入第三方库。
```

## 常见陷阱

### 陷阱1：完全放手不管

**错误做法**：
- 把任务交给 Agent
- Agent 完成后直接合并
- 不看代码改动

**后果**：
- Agent 可能引入你注意不到的 Bug
- 代码质量下降
- 后续维护困难

**正确做法**：
- Agent 完成后，必须人工审核
- 逐文件查看改动
- 测试受影响的功能

### 陷阱2：过度依赖

**错误做法**：
- 所有任务都交给 Agent
- 自己不写代码
- 完全不理解 Agent 做了什么

**后果**：
- 你的能力不提升
- 出问题时不知道怎么修
- 失去对代码的理解

**正确做法**：
- Agent 是"辅助工具"，不是"替代工具"
- 小任务自己做，大任务用 Agent
- Agent 完成后，理解改动内容

### 陷阱3：对 Agent 寄予过高期望

**错误想法**：
- "Agent 能替我设计整个 Mod"
- "Agent 能解决所有问题"
- "Agent 生成的代码就是正确的"

**现实**：
- Agent 不懂"游戏平衡性"
- Agent 不懂"玩家体验"
- Agent 可能生成错误的代码（需要验证）

**正确期望**：
- Agent 能提高效率（批量修改、代码生成）
- Agent 能辅助分析（找 Bug、找重复代码）
- Agent 不能代替设计（架构、创意）

### 陷阱4：不测试就提交

**错误做法**：
- Agent 生成代码 -> 直接提交 -> 发布

**后果**：
- 累积 Bug
- 玩家反馈问题

**正确做法**：
- Agent 生成代码 -> 编译 -> 测试 -> 提交
- 测试包括：单机、多人、边界情况

## 如何判断自己是否可以开始使用 Agent

### 自检清单

- 能看懂 Agent 生成的大部分代码（至少 80%）
- 能独立完成基础的 Mod 开发任务（物品、NPC、配方）
- 有验证 Agent 输出的能力（查文档、测试）
- 理解自己的项目结构，知道改了什么影响什么
- 能独立调试和修复常见问题

### 评估标准

如果你对上面的"Agent 能做什么"场景都能判断"Agent 说的对不对"，就可以尝试使用 Agent。

**示例判断**：

- 场景：Agent 说"要在所有 NPC 的 NPCLoot 方法里添加代码"
- 你能判断：哪些 NPC 不应该掉落物品？（召唤物、宠物）
- 你能判断：掉落率合不合理？（50% 太高，改成 10%）

如果都能判断，就可以用 Agent 了。

**如果不能判断**：
- 先提升自己的能力
- 看 `Modder入门` 下的教程
- 多练习基础的 Mod 开发

## 下一步

现在你已经掌握了编程思维、搜索、提问、AI 工具、Agent 的使用，可以开始实际的 Mod 开发了！

推荐继续学习 `Modder入门` 下的具体教程：
- {{ref:../Modder入门学习/CSharp基础/CSharp_Frist.md|C#基础教程-第一课-C#语法基础}}

从最小可运行的项目开始，逐步学习 tModLoader 的 API 和开发流程。
