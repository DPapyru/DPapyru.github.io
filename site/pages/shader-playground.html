<!DOCTYPE html>
<html lang="zh-CN" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HLSL Shader Playground - 泰拉瑞亚Mod制作教程</title>
    <meta name="description" content="在线 HLSL Shader 编辑器，支持实时预览、多 Pass 渲染，适用于 tModLoader Mod 开发。">
    <meta name="keywords" content="HLSL,Shader,tModLoader,泰拉瑞亚,Mod,WebGL">
    <link rel="stylesheet" href="/site/assets/css/style.css">
    <link rel="stylesheet" href="/site/assets/css/shader-playground.css">
    <link rel="icon" type="image/png" href="/site/assets/imgs/Green_tModLoader.png">
    <script src="/site/assets/js/theme-init.js"></script>
</head>

<body class="viewer-page shaderpg-page">
    <!-- 顶部导航栏 -->
    <header class="site-header">
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <a href="../index.html">
                        <img src="/site/assets/imgs/Green_tModLoader.png" alt="泰拉瑞亚Mod制作教程" class="logo-image">
                        <h1 class="site-title">泰拉瑞亚Mod制作教程</h1>
                    </a>
                </div>
                <nav class="main-nav" id="main-nav">
                    <ul class="nav-list">
                        <li class="nav-item"><a href="../index.html" class="nav-link">首页</a></li>
                        <li class="nav-item"><a href="folder.html" class="nav-link">文档</a></li>
                        <li class="nav-item"><a href="article-studio.html" class="nav-link">在线写作IDE</a></li>
                        <li class="nav-item"><a href="shader-playground.html" class="nav-link active" aria-current="page">Shader</a></li>
                        <li class="nav-item"><a href="../qa.html" class="nav-link">问答</a></li>
                        <li class="nav-item"><a href="https://github.com/DPapyru/DPapyru.github.io" class="nav-link" target="_blank" rel="noopener noreferrer">GitHub</a></li>
                        <li class="nav-item nav-accent">
                            <label class="visually-hidden" for="accent-select">配色</label>
                            <select class="nav-accent-select" id="accent-select" aria-label="配色">
                                <option value="green">绿色</option>
                                <option value="blue">蓝色</option>
                                <option value="purple">紫色</option>
                                <option value="orange">橙色</option>
                                <option value="red">红色</option>
                                <option value="cyan">青色</option>
                                <option value="black">黑色</option>
                                <option value="white">白色</option>
                            </select>
                        </li>
                    </ul>
                </nav>
                <button class="mobile-menu-toggle" type="button" aria-label="切换菜单" aria-controls="main-nav" aria-expanded="false">
                    <span class="bar"></span>
                    <span class="bar"></span>
                    <span class="bar"></span>
                </button>
            </div>
        </div>
    </header>

    <!-- 主内容区 -->
    <main class="main-content">
        <div class="container">
            <div class="content-wrapper">
                <!-- 面包屑导航 -->
                <div class="tutorial-header">
                    <div class="tutorial-topbar">
                        <div class="breadcrumb">
                            <a href="../index.html">首页</a> &gt;
                            <a href="folder.html">文档</a> &gt;
                            <span class="current">HLSL Shader Playground</span>
                        </div>
                    </div>
                    <h1 class="tutorial-title">HLSL Shader Playground</h1>
                    <div class="tutorial-meta">
                        <span>用途: tModLoader Shader 开发与调试</span>
                    </div>
                </div>

                <!-- Shader Playground 主体 -->
                <section class="shaderpg-shell">
                    <!-- 工具栏 -->
                    <div class="shaderpg-topbar">
                        <div class="shaderpg-topbar-left">
                            <span class="shaderpg-brand">Toy-HLSL</span>
                            <div class="shaderpg-topbar-group">
                                <button class="btn btn-small btn-outline" id="shaderpg-toggle-run" type="button">暂停</button>
                                <button class="btn btn-small btn-outline" id="shaderpg-reset-playback" type="button" title="重置动画播放时间">重播</button>
                                <button class="btn btn-small btn-outline" id="shaderpg-compile" type="button">编译</button>
                                <button class="btn btn-small btn-outline" id="shaderpg-reset" type="button">重置</button>
                            </div>
                            <div class="shaderpg-topbar-group">
                                <button class="btn btn-small" id="shaderpg-add-pass" type="button">+ 新增 Pass</button>
                                <div class="shaderpg-dropdown">
                                    <button class="btn btn-small btn-outline" id="shaderpg-pass-menu" type="button">Pass ▼</button>
                                    <div class="shaderpg-dropdown-content" id="shaderpg-pass-dropdown">
                                        <button type="button" id="shaderpg-pass-move-left">← 左移</button>
                                        <button type="button" id="shaderpg-pass-move-right">→ 右移</button>
                                        <button type="button" id="shaderpg-pass-rename">重命名</button>
                                        <button type="button" id="shaderpg-pass-delete">删除</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="shaderpg-topbar-right">
                            <div class="shaderpg-topbar-group">
                                <label class="shaderpg-inline-label" for="shaderpg-scale">分辨率</label>
                                <select class="btn btn-small btn-outline" id="shaderpg-scale">
                                    <option value="1">1x</option>
                                    <option value="0.5">0.5x</option>
                                    <option value="0.25">0.25x</option>
                                </select>
                            </div>
                            <div class="shaderpg-topbar-group">
                                <label class="shaderpg-inline-label" for="shaderpg-address-mode">采样</label>
                                <select class="btn btn-small btn-outline" id="shaderpg-address-mode" aria-label="采样越界模式">
                                    <option value="clamp">Clamp 截断</option>
                                    <option value="wrap">Wrap 循环</option>
                                </select>
                            </div>
                            <button class="btn btn-small btn-outline" id="shaderpg-layout-toggle" type="button" title="切换布局">⇄</button>
                            <button class="btn btn-small btn-outline" id="shaderpg-help-toggle" type="button" title="帮助">?</button>
                            <div class="shaderpg-stats" id="shaderpg-stats">fps: -- | 0x0</div>
                        </div>
                    </div>

                    <!-- Pass 标签 -->
                    <div class="shaderpg-pass-tabs" role="tablist" id="shaderpg-pass-tabs"></div>

                    <div class="shaderpg-command-panel" id="shaderpg-command-panel">
                        <div class="shaderpg-panel-header shaderpg-command-header">
                            <h2 class="shaderpg-panel-title">参数调节</h2>
                        </div>
                        <div class="shaderpg-command-controls" id="shaderpg-command-controls">
                            <div class="shaderpg-topbar-group shaderpg-itime-group">
                                <label class="shaderpg-inline-label" for="shaderpg-itime">iTime</label>
                                <button class="btn btn-small btn-outline" id="shaderpg-itime-minus" type="button" title="iTime -1">-1</button>
                                <input class="shaderpg-number" id="shaderpg-itime" type="number" min="-120" max="120" step="0.1" value="0">
                                <button class="btn btn-small btn-outline" id="shaderpg-itime-plus" type="button" title="iTime +1">+1</button>
                                <button class="btn btn-small btn-outline" id="shaderpg-itime-reset" type="button" title="重置 iTime">重置</button>
                            </div>
                            <div class="shaderpg-command-vars" id="shaderpg-command-vars"></div>
                        </div>
                    </div>

                    <!-- 编辑器和预览区 -->
                    <div class="shaderpg-main" id="shaderpg-main" data-layout="horizontal">
                        <section class="shaderpg-editor">
                            <div class="shaderpg-editor-surface" id="shaderpg-editor-surface">
                                <div class="shaderpg-editor-stack" id="shaderpg-editor-stack">
                                    <pre class="shaderpg-editor-highlight" id="shaderpg-editor-highlight" aria-hidden="true"><code class="shaderpg-editor-highlight-code" id="shaderpg-editor-highlight-code"></code></pre>
                                    <textarea class="shaderpg-textarea shaderpg-textarea--editor" id="shaderpg-editor" spellcheck="false" wrap="off" placeholder="// 在此编写 HLSL 代码..."></textarea>
                                </div>
                                <div class="shaderpg-autocomplete" id="shaderpg-autocomplete" role="listbox" aria-label="HLSL 自动补全"></div>
                            </div>
                            <div class="shaderpg-console">
                                <div class="shaderpg-console-title">Console</div>
                                <pre class="shaderpg-console-body" id="shaderpg-error"></pre>
                            </div>
                        </section>
                        <section class="shaderpg-preview">
                            <div class="shaderpg-canvas-wrap">
                                <canvas id="shaderpg-canvas" class="shaderpg-canvas" width="960" height="540"></canvas>
                            </div>
                            <div class="shaderpg-status" id="shaderpg-status"></div>
                        </section>
                    </div>

                    <!-- 底部面板 -->
                    <div class="shaderpg-bottom">
                        <section class="shaderpg-panel">
                            <div class="shaderpg-panel-header">
                                <h2 class="shaderpg-panel-title">Shader Inputs</h2>
                            </div>
                            <div id="shaderpg-channels" class="shaderpg-channels"></div>
                        </section>
                        <section class="shaderpg-panel">
                            <div class="shaderpg-panel-header">
                                <h2 class="shaderpg-panel-title">Textures</h2>
                                <div class="shaderpg-panel-actions">
                                    <input id="shaderpg-upload" class="btn btn-small btn-outline" type="file" accept="image/*" multiple>
                                </div>
                            </div>
                            <div id="shaderpg-textures" class="shaderpg-textures"></div>
                            <div class="shaderpg-divider"></div>
                            <div class="shaderpg-panel-header">
                                <h2 class="shaderpg-panel-title">Export</h2>
                                <div class="shaderpg-panel-actions">
                                    <button class="btn btn-small" id="shaderpg-export-fx" type="button">生成 .fx</button>
                                    <button class="btn btn-small btn-outline" id="shaderpg-copy-fx" type="button" disabled>复制</button>
                                </div>
                            </div>
                            <textarea class="shaderpg-textarea shaderpg-export" id="shaderpg-fx" spellcheck="false" readonly></textarea>
                        </section>
                    </div>

                    <!-- 底部提示 -->
                    <div class="shaderpg-hint shaderpg-hint--footer">
                        <div>提示：Ctrl+Enter 编译 | Ctrl+S 导出 | 点击右上角 ? 查看帮助</div>
                    </div>
                </section>
            </div>
        </div>
    </main>

    <!-- 教程大窗口 -->
    <div class="shaderpg-drawer" id="shaderpg-help-drawer" aria-hidden="true">
        <div class="shaderpg-drawer-header">
            <h2>帮助文档</h2>
            <button class="btn btn-small btn-outline" id="shaderpg-help-close" type="button">✕</button>
        </div>
        <div class="shaderpg-drawer-content">
            <h3>教程一：使用教程 / 页面说明</h3>
            <p>这个页面是一个实时 HLSL 预览器。你可以一边写代码，一边看右侧画布输出，并在 Console 中查看编译错误。</p>

            <h4>0. 适用对象与目标</h4>
            <p>如果你正在写 tModLoader 的特效（武器拖尾、命中闪光、UI 特效、屏幕后处理），这个页面用于快速验证公式、采样方式与多 Pass 组合。</p>
            <p>目标不是直接替代项目内所有 fx 文件，而是先在这里完成“可视化调参 + 逻辑验证”，再迁移到实际模组工程。</p>

            <h4>1. 页面分区</h4>
            <ul>
                <li><strong>顶部工具栏</strong>：运行控制、重播（重置播放时钟）、手动编译、重置、Pass 管理、布局切换、采样越界模式（Wrap/Clamp）。</li>
                <li><strong>参数调节区</strong>：iTime 实时值与 Command 变量调参。</li>
                <li><strong>Pass 标签区</strong>：切换当前编辑目标（<strong>Common</strong> 或某个 Pass）。</li>
                <li><strong>左侧编辑区</strong>：编写 HLSL；支持自动编译。</li>
                <li><strong>右侧预览区</strong>：实时画布输出与状态显示。</li>
                <li><strong>底部输入区</strong>：配置 iChannel 输入、上传纹理、导出 .fx。</li>
            </ul>

            <h4>2. 基本使用流程</h4>
            <ol>
                <li>先在 <strong>Common</strong> 写公共函数（可选）。</li>
                <li>编辑当前 Pass 的入口函数并观察实时结果。</li>
                <li>在 <strong>Shader Inputs</strong> 里给 iChannel0-3 绑定纹理。</li>
                <li>需要多阶段渲染时新增 Pass，并在下游 Pass 读取上游 Buffer。</li>
                <li>满意后点击 <strong>生成 .fx</strong> 并复制到模组项目。</li>
            </ol>

            <h4>2.1 建议调试顺序</h4>
            <ol>
                <li>先做最小可运行（只返回纯色或 uv 可视化）。</li>
                <li>再加时间项（iTime）确认动画节奏；可用参数调节区快速偏移时间。</li>
                <li>再加纹理采样（iChannel / uImage）。</li>
                <li>最后再加复杂逻辑（分支、反馈、混合）。</li>
            </ol>

            <h4>3. Pass 类型说明</h4>
            <ul>
                <li><strong>Buffer Pass</strong>：中间结果缓冲，常用于反馈、噪声累积、预处理。</li>
                <li><strong>Image Pass</strong>：最终显示层，通常作为最后输出。</li>
            </ul>

            <h4>3.1 常见多 Pass 结构</h4>
            <ul>
                <li><strong>Pass A（Buffer）</strong>：噪声/遮罩生成。</li>
                <li><strong>Pass B（Buffer）</strong>：边缘检测或模糊。</li>
                <li><strong>Pass C（Image）</strong>：把 A/B 与主纹理合成输出。</li>
            </ul>

            <h4>4. 快捷键</h4>
            <ul>
                <li><strong>Ctrl + Enter</strong>：手动编译。</li>
                <li><strong>Ctrl + S</strong>：生成 .fx。</li>
                <li><strong>Tab</strong>：缩进。</li>
                <li><strong>Shift + Tab</strong>：反缩进。</li>
                <li><strong>Ctrl + Space</strong>：手动触发自动补全。</li>
            </ul>

            <h4>5. 常见问题</h4>
            <ul>
                <li><strong>画面全黑</strong>：先检查入口函数是否返回有效 alpha，及 iChannel 是否绑定纹理。</li>
                <li><strong>编译报错定位困难</strong>：先把复杂表达式拆成中间变量，一段段恢复。</li>
                <li><strong>UV 超出范围行为不对</strong>：确认顶部采样模式。<strong>Wrap 循环</strong> 类似 tModLoader 的 <code>LinearWrap</code>，<strong>Clamp 截断</strong> 类似 <code>LinearClamp</code>。</li>
                <li><strong>效果在项目里不一致</strong>：确认项目内采样坐标系、混合状态和参数来源一致。</li>
            </ul>

            <h3>教程二：编写教程</h3>
            <p>本编辑器面向 HLSL 3.0 子集，并兼容常见 tModLoader fx 写法。推荐从“最小可运行”开始，再逐步拆成多 Pass。</p>

            <h4>0. 编写前 checklist</h4>
            <ul>
                <li>先确定你要做的是“颜色变化”“形状变化”还是“采样重组”。</li>
                <li>先定义输入：时间、纹理、屏幕坐标、角色参数。</li>
                <li>先决定是否需要 Buffer Pass（反馈/预处理常需要）。</li>
            </ul>

            <h4>1. 入口函数写法</h4>
            <pre><code>// 写法 A：ShaderToy 风格
float4 mainImage(float2 fragCoord)

// 写法 B：out 参数风格
void mainImage(out float4 fragColor, float2 fragCoord)

// 写法 C：tModLoader 常见像素着色器风格
float4 MainPS(float2 texCoord : TEXCOORD0) : COLOR0</code></pre>

            <h4>2. 可用变量与纹理</h4>
            <pre><code>float iTime, iTimeDelta;
int iFrame;
float3 iResolution;
float4 iMouse;
float4 iDate;
sampler2D iChannel0..3;
sampler2D uImage0..3;   // 自动映射到 iChannel0..3</code></pre>

            <h4>2.1 坐标建议</h4>
            <pre><code>// 屏幕坐标 -> 0~1
float2 uv = fragCoord / iResolution.xy;

// 中心化坐标 -> -1~1
float2 p = uv * 2.0 - 1.0;</code></pre>

            <h4>2.2 自定义变量（Command）示例</h4>
            <pre><code>// 标量参数：会在“参数调节”区自动出现
float speed = 1.0;       // Command(min=0,max=5,step=0.1)
float amplitude = 0.5;   // Command(0, 2, 0.1)
int iterations = 3;      // Command(min=1,max=8,step=1)

// iTime：可在参数调节区直接输入，并可自定义输入框步长
// 例如把步长改为 0.5，便于做节奏更粗的调参

// 向量/矩阵固定值（当前推荐写法）
float2 uvOffset = float2(0.0, 0.0);
float2x2 rotMatFixed = float2x2(1.0, 0.0, 0.0, 1.0);

// 向量/矩阵可变值：先拆成可调标量，再组装
float m00 = 1.0; // Command(min=-2,max=2,step=0.1)
float m01 = 0.0; // Command(min=-2,max=2,step=0.1)
float m10 = 0.0; // Command(min=-2,max=2,step=0.1)
float m11 = 1.0; // Command(min=-2,max=2,step=0.1)
float2x2 rotMat = float2x2(m00, m01, m10, m11);</code></pre>

            <h4>3. 常用类型与函数</h4>
            <pre><code>// 类型
float2/3/4, int2/3/4, uint2/3/4, bool2/3/4
float2x2, float3x3, float4x4
half/fixed/min16float

// 函数映射
lerp, frac, rsqrt, ddx, ddy, saturate
tex2D, tex2Dproj, tex2Dgrad, tex2Dbias
mul, clip, atan2, mad, rcp, log10</code></pre>

            <h4>4. 编写建议（tModLoader 习惯）</h4>
            <ul>
                <li>在 <strong>Common</strong> 放工具函数，Pass 内只写当前阶段逻辑。</li>
                <li>Image Pass 尽量只负责最终合成，避免塞入过多状态逻辑。</li>
                <li>需要移植到项目时，优先保留函数结构与参数命名，再替换业务纹理与参数。</li>
            </ul>

            <h4>5. 最小示例到可用示例</h4>
            <pre><code>// Step 1: 最小可运行
float4 MainPS(float2 texCoord : TEXCOORD0) : COLOR0 {
    return float4(texCoord, 0.0, 1.0);
}

// Step 2: 增加时间动画
float4 MainPS(float2 texCoord : TEXCOORD0) : COLOR0 {
    float wave = 0.5 + 0.5 * sin(iTime + texCoord.x * 8.0);
    return float4(texCoord.x, texCoord.y, wave, 1.0);
}</code></pre>

            <h4>6. 迁移到 tModLoader 的建议步骤</h4>
            <ol>
                <li>先把入口函数与工具函数迁移到项目 fx。</li>
                <li>把 iChannel/uImage 替换成项目里的实际 sampler。</li>
                <li>把 iTime/iResolution 替换为项目参数并在 C# 侧写入。</li>
                <li>最后在游戏中验证混合状态与绘制顺序。</li>
            </ol>
        </div>
    </div>

    <!-- 抽屉遮罩 -->
    <div class="shaderpg-drawer-overlay" id="shaderpg-drawer-overlay" aria-hidden="true"></div>

    <!-- 网站底部 -->
    <footer class="site-footer">
        <div class="container">
            <div class="footer-content">
                <p>&copy; 2024 泰拉瑞亚Mod制作教程. 基于 tModLoader 开发.</p>
            </div>
        </div>
    </footer>

    <script src="/shared/assets/js/site-core.js"></script>
    <script>
        if (window.SITE) window.SITE.bootstrapPage('shader-playground');
    </script>
    <script src="/site/assets/js/accent-theme.js"></script>
    <script src="/site/assets/js/shader-hlsl-adapter.js"></script>
    <script src="/site/assets/js/shader-editor-assist.js"></script>
    <script src="/site/assets/js/shader-command-params.js"></script>
    <script src="/site/assets/js/shader-playground.js"></script>
</body>
</html>
